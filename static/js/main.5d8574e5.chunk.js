(this["webpackJsonpreact-near-openweb-example"]=this["webpackJsonpreact-near-openweb-example"]||[]).push([[0],{118:function(e,t){},123:function(e,t){},143:function(e,t,n){"use strict";n.r(t);var r=n(15),a=n.n(r),i=n(61),o=n.n(i),c=(n(71),n(24)),s=n(25),u=n(64),p=n(62),l=n(65),f=n(63),h=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(f.Profile,{accountId:"eugenethedream"}))}}]),t}(r.Component);o.a.render(a.a.createElement(h,null),document.getElementById("root"))},63:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Profile=void 0;var r,a=n(72),i=(r=a)&&r.__esModule?r:{default:r};t.Profile=i.default},66:function(e,t,n){e.exports=n(143)},71:function(e,t,n){},72:function(e,t,n){"use strict";var r=n(0);Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=s(n(74)),o=n(77),c=s(n(140));function s(e){return e&&e.__esModule?e:{default:e}}var u={accountId:c.default.string.isRequired,defaultProfileUrl:c.default.string,displayName:c.default.string,profileUrl:c.default.string,bio:c.default.string,onFetch:c.default.func,forceShow:c.default.bool},p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.state={displayName:"",profileUrl:null,bio:"",loading:!1,found:!1};var r=n.props.nearConfig||window.nearConfig||{networkId:"default",nodeUrl:"https://rpc.nearprotocol.com",walletUrl:"https://wallet.nearprotocol.com"};return window.profileComponentCache||(window.profileComponentCache={profileCache:{},app:new o.OpenWebApp("profile",null,r)},window.profileComponentCache.app.init()),n.profileCache=window.profileComponentCache.profileCache,n.app=window.profileComponentCache.app,n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentDidMount",value:function(){var e=this;this.props.accountId&&this.app.ready().then((function(){return e.updateProfile(e.props.accountId)}))}},{key:"fetchProfile",value:function(){var e,t=(e=r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.profileCache)){e.next=6;break}return e.next=3,this.profileCache[t];case 3:return e.abrupt("return",e.sent);case 6:return console.log("Fetching profile for "+t),this.profileCache[t]=Promise.all([this.app.getFrom(t,"displayName"),this.app.getFrom(t,"profileUrl"),this.app.getFrom(t,"bio")]).then((function(e){return{accountId:t,displayName:e[0]||"",profileUrl:e[1],bio:e[2]||""}})).catch((function(e){return!1})),e.next=10,this.profileCache[t];case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)})),function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function r(a,i){try{var o=t[a](i),c=o.value}catch(s){return void n(s)}if(!o.done)return Promise.resolve(c).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(c)}("next")}))});return function(e){return t.apply(this,arguments)}}()},{key:"updateProfile",value:function(e){var t=this;this.setState({displayName:"",profileUrl:null,bio:"",loading:!0,found:!1}),this.fetchProfile(this.props.accountId).then((function(e){e?t.setState({displayName:e.displayName,profileUrl:e.profileUrl,bio:e.bio,loading:!1,found:!0}):t.setState({loading:!1,found:!1}),t.props.onFetch&&t.props.onFetch(e)}))}},{key:"componentDidUpdate",value:function(e){this.props.accountId!==e.accountId&&this.updateProfile(this.props.accountId)}},{key:"render",value:function(){var e=this.props.displayName||this.state.displayName,t=this.props.profileUrl||this.state.profileUrl||this.props.defaultProfileUrl,n=this.props.bio||this.state.bio,r=this.props.accountId,a=this.props.styles;return this.state.loading?i.default.createElement("div",{style:a.profile},i.default.createElement("div",{className:"spinner-grow",role:"status"},i.default.createElement("span",{className:"sr-only"},"Loading..."))):this.state.found||this.props.forceShow?i.default.createElement("div",{style:a.profile,title:n},i.default.createElement("img",{style:a.profileImage,src:t,alt:"Profile @"+r}),i.default.createElement("span",{style:a.profileName},i.default.createElement("span",{style:a.profileDisplayName},e),i.default.createElement("span",{style:a.profileAccountId},"(@"+r+")"))):null}}]),t}(i.default.Component);p.propTypes=u,p.defaultProps={defaultProfileUrl:null,styles:{profile:{whiteSpace:"nowrap",display:"inline-block"},profileImage:{height:"3em",width:"3em",borderRadius:"50%",verticalAlign:"middle"},profileName:{overflowY:"hidden",marginLeft:"0.5em",verticalAlign:"middle"},profileDisplayName:{},profileAccountId:{color:"#999"}}},t.default=p},77:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"encryptionKey",(function(){return p})),n.d(t,"OpenWebApp",(function(){return l}));var r=n(0),a=n.n(r),i=n(3),o=n(24),c=n(25),s=n(13),u=n(1),p="encryptionKey",l=function(){function t(n,r,a){Object(o.a)(this,t),this.appId=n,this.accountId=r,this._nearConfig=a,this.blocking=Promise.resolve(),this.parseEncryptionKey(),window.nacl=u,window.Buffer=e}return Object(c.a)(t,[{key:"parseEncryptionKey",value:function(){var t="enc_key:"+this.accountId+":"+this.appId+":",n=localStorage.getItem(t);n?n=u.box.keyPair.fromSecretKey(e.from(n,"base64")):(n=new u.box.keyPair,localStorage.setItem(t,e.from(n.secretKey).toString("base64"))),this._key=n}},{key:"_innerInit",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._keyStore=new s.keyStores.BrowserLocalStorageKeyStore(localStorage,"app:"+this.appId),e.next=3,s.connect(Object.assign({deps:{keyStore:this._keyStore}},this._nearConfig));case 3:return this._near=e.sent,this._account=new s.Account(this._near.connection,this.accountId),this._contract=new s.Contract(this._account,this.accountId,{viewMethods:["get","apps","num_messages"],changeMethods:["set","remove","pull_message","send_message"],sender:this.accountId}),this._networkId=this._nearConfig.networkId,e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._ready||(this._ready=this._innerInit()));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ready",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.init());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAccessPublicKey",value:function(){var e=Object(i.a)(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._keyStore.getKey(this._networkId,this.accountId);case 2:if(!(t=e.sent)){e.next=5;break}return e.abrupt("return",t.getPublicKey());case 5:if(!this._tmpKey){e.next=7;break}return e.abrupt("return",this._tmpKey.getPublicKey());case 7:return n=s.KeyPair.fromRandom("ed25519"),this._tmpKey=n,e.abrupt("return",n.getPublicKey());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getEncryptionPublicKey",value:function(){return e.from(this._key.publicKey).toString("base64")}},{key:"storeEncryptionPublicKey",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.set(p,this.getEncryptionPublicKey()));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onKeyAdded",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._tmpKey){e.next=2;break}throw new Error("The key is not initialized yet");case 2:return e.next=4,this._keyStore.setKey(this._networkId,this.accountId,this._tmpKey);case 4:this._tmpKey=null;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"forceReady",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ready();case 2:if(e.sent){e.next=4;break}throw new Error("Not ready yet");case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"wrappedCall",value:function(e){return this.blocking=this.blocking.then((function(){return e()})).catch((function(){return e()})),this.blocking}},{key:"decryptSecretBox",value:function(t){var n=e.from(t,"base64"),r=new Uint8Array(u.secretbox.nonceLength);n.copy(r,0,0,r.length);var a=new Uint8Array(n.length-u.secretbox.nonceLength);n.copy(a,0,r.length);var i=u.secretbox.open(a,r,this._key.secretKey);return e.from(i).toString()}},{key:"encryptSecretBox",value:function(t){var n=e.from(t),r=u.randomBytes(u.secretbox.nonceLength),a=u.secretbox(n,r,this._key.secretKey),i=new Uint8Array(a.length+u.secretbox.nonceLength);return i.set(r),i.set(a,u.secretbox.nonceLength),e.from(i).toString("base64")}},{key:"decryptBox",value:function(t,n){if(n.length!==u.box.publicKeyLength)throw new Error("Given encryption public key is invalid.");var r=e.from(t,"base64"),a=new Uint8Array(u.box.nonceLength);r.copy(a,0,0,a.length);var i=new Uint8Array(r.length-u.box.nonceLength);r.copy(i,0,a.length);var o=u.box.open(i,a,n,this._key.secretKey);return e.from(o).toString()}},{key:"encryptBox",value:function(t,n){if(n.length!==u.box.publicKeyLength)throw new Error("Given encryption public key is invalid.");var r=e.from(t),a=u.randomBytes(u.box.nonceLength),i=u.box(r,a,n,this._key.secretKey),o=new Uint8Array(i.length+u.box.nonceLength);return o.set(a),o.set(i,u.box.nonceLength),e.from(o).toString("base64")}},{key:"get",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object.assign({encrypted:!1,appId:this.appId},n),e.next=3,this._contract.get({app_id:n.appId,key:t});case 3:return(r=e.sent)&&(r=JSON.parse(n.encrypted?this.decryptSecretBox(r):r)),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getFrom",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n,r){var i,o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.assign({encrypted:!1,appId:this.appId},r),i=new s.Account(this._near.connection,t),o=new s.Contract(i,t,{viewMethods:["get"],changeMethods:[],sender:this.accountId}),e.next=5,o.get({app_id:r.appId,key:n});case 5:return(c=e.sent)&&(c=JSON.parse(r.encrypted?this.decryptSecretBox(c):c)),e.abrupt("return",c);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"apps",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._contract.apps();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n,r){var i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.forceReady();case 2:return r=Object.assign({encrypted:!1},r),e.next=5,this.wrappedCall((function(){return i._contract.set({key:t,value:r.encrypted?i.encryptSecretBox(JSON.stringify(n)):JSON.stringify(n)},2e15)}));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.forceReady();case 2:return e.next=4,this.wrappedCall((function(){return n._contract.remove({key:t},2e15)}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"pullMessage",value:function(){var e=Object(i.a)(a.a.mark((function e(){var t=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.forceReady();case 2:return e.next=4,this._contract.num_messages({app_id:this.appId});case 4:if(e.t0=e.sent,!(e.t0>0)){e.next=11;break}return e.next=8,this.wrappedCall((function(){return t._contract.pull_message({},2e15)}));case 8:return e.abrupt("return",e.sent);case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTheirPublicKey",value:function(){var t=Object(i.a)(a.a.mark((function t(n){var r,i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=Object.assign({accountId:null,theirPublicKey:null,theirPublicKey64:null,encryptionKey:p,appId:this.appId},n)).theirPublicKey){t.next=3;break}return t.abrupt("return",n.theirPublicKey);case 3:if(n.theirPublicKey64){t.next=9;break}if(n.accountId){t.next=6;break}throw new Error("Either accountId or theirPublicKey64 has to be provided");case 6:return t.next=8,this.getFrom(n.accountId,n.encryptionKey,{appId:n.appId});case 8:n.theirPublicKey64=t.sent;case 9:if(n.theirPublicKey64){t.next=11;break}throw new Error("Their app doesn't provide the encryption public key.");case 11:if((r=e.from(n.theirPublicKey64,"base64")).length===u.box.publicKeyLength){t.next=14;break}throw new Error("Their encryption public key is invalid.");case 14:return(i=new Uint8Array(u.box.publicKeyLength)).set(r),t.abrupt("return",i);case 17:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"encryptMessage",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTheirPublicKey(n);case 2:return r=e.sent,e.abrupt("return",this.encryptBox(t,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"decryptMessage",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTheirPublicKey(n);case 2:return r=e.sent,e.abrupt("return",this.decryptBox(t,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n,r){var i=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.forceReady(),r=Object.assign({appId:this.appId},r),e.next=4,this.wrappedCall((function(){return i._contract.send_message({receiver_id:t,app_id:r.appId,message:n},2e15)}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),t}()}.call(this,n(8).Buffer)},93:function(e,t){},95:function(e,t){}},[[66,1,2]]]);
//# sourceMappingURL=main.5d8574e5.chunk.js.map